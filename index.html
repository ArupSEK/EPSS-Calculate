<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EPSS Lookup (CVE ‚Üí EPSS)</title>
  <link rel="stylesheet" href="styles.css" />

  <!-- SheetJS (Excel read/write) -->
  <script src="https://cdn.sheetjs.com/xlsx-0/frontend/xlsx.full.min.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>

<body>
  <!-- Top Bar -->
  <header class="topbar">
    <div class="container topbar__inner">
      <div class="brand">
        <div class="brand__logo">EP</div>
        <div class="brand__text">
          <div class="brand__name">EPSS Lookup</div>
          <div class="brand__sub">CVE ‚Üí EPSS (Search + Excel Upload)</div>
        </div>
      </div>

      <div class="topbar__actions">
        <!-- Animated "Developed by" Badge -->
        <div class="devBadge" title="Developed by Arup Basak">
          <div class="devBadge__dot"></div>
          <div class="devBadge__text">Developed by <b>Arup Basak</b></div>
        </div>

        <a class="btn btn--ghost btn--small" target="_blank" rel="noreferrer"
           href="https://www.first.org/epss/api">FIRST EPSS API</a>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- Hero -->
    <section class="card hero">
      <div>
        <h1>EPSS Lookup</h1>
        <div class="muted">
          Fetch EPSS scores from CVE IDs ‚Äî paste CVEs, or upload an Excel file and add an EPSS column.
        </div>

        <div class="hero__stats">
          <div class="pill">‚úÖ Batch up to <b>100 CVEs</b>/request</div>
          <div class="pill">‚úÖ Column toggles (EPSS / Percentile / Date)</div>
          <div class="pill">‚úÖ Copy table ‚Üí paste into Excel</div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
          <button class="tab tab--active" data-tab="search" type="button">Quick Search</button>
          <button class="tab" data-tab="excel" type="button">Excel Upload</button>
        </div>
      </div>

      <!-- Slider / Visual -->
      <div class="card slider card--soft">
        <div class="slider__slide slider__slide--active">
          <div class="slideTitle">‚ö° Quick Search</div>
          <div class="slideBody">Paste one CVE or multiple CVEs. Get EPSS in a clean table format.</div>
        </div>
        <div class="slider__slide">
          <div class="slideTitle">üìÑ Excel Upload</div>
          <div class="slideBody">Upload your findings sheet and add EPSS columns row-wise.</div>
        </div>
        <div class="slider__slide">
          <div class="slideTitle">üõ°Ô∏è Error Handling</div>
          <div class="slideBody">Handles invalid CVE formats, missing values, and API/network errors.</div>
        </div>

        <div class="slider__dots">
          <div class="dot dot--active"></div>
          <div class="dot"></div>
          <div class="dot"></div>
        </div>
      </div>
    </section>

    <!-- Quick Search Panel -->
    <section id="tab-search" class="card tabPanel">
      <h2>Quick Search</h2>

      <label class="label" for="cveInput">Enter CVE(s)</label>
      <textarea id="cveInput" class="input" rows="4"
        placeholder="Example:
CVE-2022-27225
CVE-2022-27223
CVE-2022-27218"></textarea>

      <div class="row">
        <button id="btnSearch" class="btn" type="button">Fetch EPSS</button>
        <button id="btnClearSearch" class="btn btn--ghost" type="button">Clear</button>
      </div>

      <div id="searchStatus" class="status"></div>

      <!-- Results (TABLE ONLY) -->
      <div class="resultBox" style="margin-top:14px;">
        <div class="resultBox__header">
          <div>
            <div class="label" style="margin:0;">Results</div>
            <div class="tiny">Select columns you want to display</div>
          </div>

          <div class="row" style="margin:0;">
            <label class="chip">
              <input type="checkbox" id="colEpss" checked />
              <span>EPSS</span>
            </label>

            <label class="chip">
              <input type="checkbox" id="colPercentile" checked />
              <span>Percentile</span>
            </label>

            <label class="chip">
              <input type="checkbox" id="colDate" checked />
              <span>Date</span>
            </label>

            <button id="btnCopyTable" class="btn btn--ghost btn--small" type="button">
              Copy Table
            </button>
          </div>
        </div>

        <div class="tableWrap tableWrap--results">
          <table id="resultsTable" class="table table--results">
            <thead></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Excel Upload Panel -->
    <section id="tab-excel" class="card tabPanel hidden">
      <h2>Excel Upload</h2>

      <div class="grid2">
        <div>
          <label class="label" for="fileInput">Upload Excel (.xlsx)</label>
          <input id="fileInput" class="input" type="file" accept=".xlsx,.xls" />

          <div class="row">
            <button id="btnProcessExcel" class="btn" type="button">Process & Export</button>
            <button id="btnClearExcel" class="btn btn--ghost" type="button">Reset</button>
          </div>

          <div class="progress">
            <div id="progressBar" class="progress__bar" style="width:0%"></div>
          </div>

          <div id="excelStatus" class="status"></div>

          <div class="tiny" style="margin-top:10px;">
            Tip: Keep your CVEs in any column ‚Äî the app will detect patterns like <b>CVE-2024-12345</b>.
          </div>
        </div>

        <div>
          <h3>EPSS Distribution</h3>
          <div class="card card--soft" style="padding:12px;">
            <canvas id="epssChart" height="160"></canvas>
          </div>
          <div class="tiny">Chart updates after processing your Excel file.</div>
        </div>
      </div>
    </section>

    <div class="footer">
      Built for CVE EPSS scoring ‚Ä¢ Uses FIRST EPSS API ‚Ä¢ Developed by <b>Arup Basak</b>
    </div>
  </main>

  <!-- Toast -->
  <div id="toast" class="toast hidden"></div>

  <script src="app.js"></script>
</body>
</html>
