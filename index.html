<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EPSS Lookup (CVE â†’ EPSS)</title>
  <link rel="stylesheet" href="styles.css" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>

<body>
  <header class="topbar">
    <div class="container topbar__inner">
      <div class="brand">
        <div class="brand__logo">EP</div>
        <div class="brand__text">
          <div class="brand__name">EPSS Lookup</div>
          <div class="brand__sub">CVE â†’ EPSS (Excel + Search)</div>
        </div>
      </div>

      <div class="topbar__actions">
        <div class="devBadge" title="Developed by Arup Basak">
          <div class="devBadge__dot"></div>
          <div class="devBadge__text">Developed by <b>Arup Basak</b></div>
        </div>

        <a class="btn btn--ghost btn--small" target="_blank" rel="noreferrer"
           href="https://www.first.org/epss/api">API Docs</a>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- Hero -->
    <section class="card hero">
      <div>
        <h1>EPSS Lookup</h1>
        <div class="muted">
          Paste CVE IDs (comma or new line) or upload Excel. Get EPSS in a clean table + export updated workbook.
        </div>

        <div class="hero__stats">
          <div class="pill">âš¡ Batch up to <b>100 CVEs</b>/request</div>
          <div class="pill">ðŸ§  Detects CVEs anywhere in a row</div>
          <div class="pill">ðŸ“¤ Export Excel with EPSS columns</div>
        </div>

        <div class="tabs">
          <button class="tab tab--active" data-tab="search" type="button">Quick Search</button>
          <button class="tab" data-tab="excel" type="button">Excel Upload</button>
        </div>
      </div>

      <div class="card slider card--soft">
        <div class="slider__slide slider__slide--active">
          <div class="slideTitle">âœ¨ Table-only results</div>
          <div class="slideBody">No JSON. Clean, sortable table with column toggles.</div>
        </div>
        <div class="slider__slide">
          <div class="slideTitle">ðŸ“„ Excel processing</div>
          <div class="slideBody">Adds EPSS Score/Percentile/Date + CVEs Found at the end.</div>
        </div>
        <div class="slider__slide">
          <div class="slideTitle">ðŸŽ¯ Dopamine UI</div>
          <div class="slideBody">Color badges + quick summaries + export buttons.</div>
        </div>

        <div class="slider__dots">
          <div class="dot dot--active"></div>
          <div class="dot"></div>
          <div class="dot"></div>
        </div>
      </div>
    </section>

    <!-- Quick Search -->
    <section id="tab-search" class="card tabPanel">
      <h2>Quick Search</h2>
      <div class="muted">Paste one or many CVEs. We fetch EPSS score, percentile and date.</div>

      <label class="label" for="cveInput">CVE(s)</label>
      <textarea id="cveInput" class="input" rows="4"
        placeholder="Example: CVE-2022-27225, CVE-2022-27223
or new lines:
CVE-2022-27225
CVE-2022-27223"></textarea>

      <div class="row">
        <button id="btnSearch" class="btn" type="button">
          <span class="btnText">Fetch EPSS</span>
          <span class="btnSpinner" aria-hidden="true"></span>
        </button>
        <button id="btnClearSearch" class="btn btn--ghost" type="button">Clear</button>
      </div>

      <div id="searchStatus" class="status"></div>

      <!-- Summary -->
      <div class="summaryRow" id="searchSummary" style="display:none;">
        <div class="summaryChip" id="sumFound">Found: 0/0</div>
        <div class="summaryChip" id="sumMax">Max EPSS: 0</div>
        <div class="summaryChip" id="sumAvg">Avg EPSS: 0</div>
      </div>

      <!-- Results (TABLE ONLY) -->
      <div class="resultBox" style="margin-top:14px;">
        <div class="resultBox__header">
          <div>
            <div class="label" style="margin:0;">Results</div>
            <div class="tiny">Toggle columns â€¢ click headers to sort â€¢ export quickly</div>
          </div>

          <div class="row" style="margin:0;">
            <label class="chip">
              <input type="checkbox" id="colEpss" checked />
              <span>EPSS</span>
            </label>

            <label class="chip">
              <input type="checkbox" id="colPercentile" checked />
              <span>Percentile</span>
            </label>

            <label class="chip">
              <input type="checkbox" id="colDate" checked />
              <span>Date</span>
            </label>

            <button id="btnCopyTable" class="btn btn--ghost btn--small" type="button">Copy Table</button>
            <button id="btnDownloadCsv" class="btn btn--ghost btn--small" type="button">Download CSV</button>
          </div>
        </div>

        <div class="tableWrap tableWrap--results">
          <table id="resultsTable" class="table table--results">
            <thead></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Excel Upload -->
    <section id="tab-excel" class="card tabPanel hidden">
      <h2>Excel Upload</h2>

      <div class="grid2">
        <div>
          <label class="label" for="fileInput">Upload Excel (.xlsx/.xls/.xlsm/.xlsb) or CSV</label>
          <input id="fileInput" class="input" type="file" accept=".xlsx,.xls,.xlsm,.xlsb,.csv,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,text/csv" />

          <div class="row">
            <button id="btnProcessExcel" class="btn" type="button">
              <span class="btnText">Process & Export</span>
              <span class="btnSpinner" aria-hidden="true"></span>
            </button>
            <button id="btnClearExcel" class="btn btn--ghost" type="button">Reset</button>
          </div>

          <div class="progress">
            <div id="progressBar" class="progress__bar" style="width:0%"></div>
          </div>

          <div id="excelStatus" class="status"></div>

          <div class="previewControls">
            <div>
              <label class="label" for="excelColumnSelect">CVE Column</label>
              <select id="excelColumnSelect" class="input"></select>
            </div>

            <div>
              <div class="label">Multiple CVEs</div>
              <div class="choiceGroup">
                <label class="choiceChip">
                  <input type="radio" name="multiEpssMode" value="comma" checked />
                  <span>Keep EPSS list (comma-separated)</span>
                </label>
                <label class="choiceChip">
                  <input type="radio" name="multiEpssMode" value="max" />
                  <span>Keep highest EPSS only</span>
                </label>
              </div>
            </div>
          </div>

          <div class="label">Preview</div>
          <div class="tableWrap tableWrap--preview">
            <table id="excelPreviewTable" class="table table--preview">
              <thead></thead>
              <tbody></tbody>
            </table>
          </div>
          <div id="excelPreviewStatus" class="tiny">Upload a file to preview the sheet and choose a column.</div>

          <div class="tiny" style="margin-top:10px;">
            âœ… Accepts .xlsx, .xls, .xlsm, .xlsb, or .csv files.<br/>
            âœ… Choose the column that contains CVEs before processing.<br/>
            âœ… Adds new columns at the end: <b>EPSS Score</b>, <b>EPSS Percentile</b>, <b>EPSS Date</b>, <b>EPSS CVEs Found</b>.
          </div>
        </div>

        <div>
          <h3>EPSS Distribution</h3>
          <div class="card card--soft" style="padding:12px;">
            <canvas id="epssChart" height="160"></canvas>
          </div>
          <div class="tiny">Chart updates after Excel processing.</div>
        </div>
      </div>
    </section>

    <div class="footer">
      Built as a static site for GitHub Pages â€¢ EPSS data from FIRST EPSS API â€¢ Developed by <b>Arup Basak</b>
    </div>
  </main>

  <div id="toast" class="toast hidden"></div>

  <script src="app.js"></script>
</body>
</html>
